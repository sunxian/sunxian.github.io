---
layout: post
title:  "前后分离CAS单点登录"
description: "前后分离 CAS单点登录"
category: java
tags: [java,cas]
---
## 传统CAS认证流程



![img](assets\images\1732503004168-9ddc0bb2-b4ee-4ef6-8c9f-c3ec70cfa536.png)



##  前后端分离CAS 认证

![cf450f46c2cd292a05ea36323030725](assets\images\cf450f46c2cd292a05ea36323030725.png)

注：上图 POST https://app.example.com/ body: {ticket=ST-12345678,tgt=TGT-12345678}   tgt需要传递给各个应用，应用的access_token需要与tgt进行关

联，使得单点登出的时候通过tgt失效各应用的access_token。

## 核心概念

#### TGT（Ticket Granting Ticket）

- **功能**：TGT 是用户登录 CAS 系统后生成的一个长生命周期票据，保存在 CAS 服务器中，通常与用户的会话绑定。
- **用途**：它允许用户在其会话期间免登录地访问其他受保护的服务（单点登录 SSO 的核心）。
- **存储**：TGT 的标识（通常是一个加密 token 或 ID）保存在客户端（如 Cookie）中。

#### ST（Service Ticket）

- **功能**：ST 是短生命周期的一次性票据，专门为目标服务生成，用于证明用户身份。
- **用途**：当用户请求访问某个受 CAS 保护的服务时，客户端（通常是浏览器）使用保存的 TGT 从 CAS 服务器获取一个 ST，随后将该 ST 提交给目标服务以完成认证。
- **特点**：每个 ST 只能使用一次，防止重放攻击。



## 前后端分离的CAS与传统CAS的区别

1. **认证机制**：

- - **传统 CAS**：依赖于 TGC 和 ST，使用 Cookie 管理用户会话状态。用户登录后，前端和后端之间的交互依赖于服务器的 Session。
  - **前后端分离**：使用 JWT 或其他 Token 进行身份验证，前端负责存储 Token，并在请求中携带。

2. **通信方式**：

- - **传统 CAS**：前端通常通过页面重定向与后端进行交互，前后端之间的通信较为紧密。
  - **前后端分离**：前端和后端之间通过 API 进行数据交互，通常使用 AJAX 请求。

3. **接口数量**
   - 前后端分离的CAS比传统的多了些接口，比方说检查是否已经单点登录的接口/cas/checkLogin。
4. **CORS**
   - 后端需要开放跨域。



## 一些思考

#### 能否取消 ST，仅使用 TGT？  

不推荐取消。主要有以下原因：
**安全性**：ST 是一次性票据，有效防止票据被截获后反复使用，增强了安全性。

每个服务都可以有自己的ST，确保每个服务的访问是独立的。即使一个ST被泄露，攻击者也只能访问该特定服务，而不能访问其他服务。
**协议标准**：CAS 的核心设计思想就是将 TGT 用作长生命周期票据，ST 用作短期的一次性认证票据，取消 ST 可能破坏协议兼容性。
**扩展性**：使用 ST，可以让目标服务在验证过程中不直接接触 TGT，提高系统解耦性。  ST可以做分布式验证。